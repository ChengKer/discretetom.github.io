---
layout: collection
author: DiscreteTom
catalog: true
title: '微处理器外部特性与输入输出'
collection: MicrocomputerPrincipleAndInterfaceTechnology
---

## 8086管脚

### 主要管脚

![5-1](img/5-1.png)

主要管脚：
- AD15-AD0
  - 时分复用地址数据线（为了减少对外引脚个数
  - ALE为1时为地址线，为0时为数据线
- A19/S6-A16-S3
  - 20位地址线的高四位
  - 或状态线S6-S3
- M/~IO
  - 表示当前地址是存储器地址还是IO地址
- ~RD
  - 表示是否读
- ~WR
  - 表示是否写
- ALE
  - 地址锁存允许信号，高电平表示AD线传输的是地址
- DT/~R
  - 数据发送(transmit)或接受(receive)信号
- ~DEN
  - data enable数据允许信号
- INTR
  - interupt request中断请求
  - INTR为1且IF(S5)为1时CPU准备进行中断服务。当前指令执行完后~INTA变为低电平以响应中断
- ~INTA
  - 中断响应信号
- CLK
  - 时钟，8086时钟为5MHz
- VCC
  - 电源5V
- GND
  - 地线0V
- MN/~MX
  - 工作模式，MN表示最小模式，MX表示最大模式

### 工作状态S7-S0

S7恒为1，S6恒为0，S5为IF

S4和S3表示当前总线周期哪一个段正在被存取：

![5-2](img/5-2.png)

S2-S0表示当前总线周期的功能：

![5-3](img/5-3.png)

## 总线周期与时序

### 概述

**总线周期**是**CPU完成一次访存（或IO端口）操作所需要的时间**，8086CPU的基本总线周期包括**4个时钟周期**，命名为T1-T4

**Ti**表示在两个**总线周期**之间插入的**空闲时钟周期**

如果一次IO或存储器存取时间较长，则根据需要在T3和T4之间插入若干个**等待周期Tw**以保证访存正常进行

![5-4](img/5-4.png)

### 读周期时序

![5-5](img/5-5.png)

- T1
  - 送出20位地址
  - 按需设置M/~IO
  - ALE使地址生效（锁存地址
  - DT/~R设置为接收态
- T2
  - 此时地址已经被锁存，AD线可以不再表示地址，A19-A16表示S7-S3
  - 按需启动~RD信号
  - 启动~DEN信号
- T3
  - T3的前沿（下降沿）采样READY信号，如果为1则表示结束，否则表示没有结束，在T3后面插入Tw
  - 数据被放入数据总线
- T4
  - T4的前沿采样数据总线，获得数据
  - 然后所有信号变为无效

## 8086工作模式

8086工作模式有最大模式和最小模式

- 最小模式 - 系统中只有一个8086处理器，所有总线控制信号都由此8086产生，系统的总线控制逻辑电路被减到最少
- 最大模式 - 可以包含一个主处理器和很多协处理器（如数值运算协处理器8087、输入输出协处理器8089），需要使用8288总线控制器来产生不同的控制信号

通电后设置8086的MN/~MX电平以控制CPU的工作模式

## 8086存储器

数据总线16位，地址总线20位，可寻址1M字节

利用BHE信号线，可以按不同方式寻址：

![5-6](img/5-6.png)

**如果一个字放在奇地址开始的边界上，则需要两个总线周期才能完成读写操作**（因为要发出两次字节读取信号

## IO接口概述

**IO接口指微处理器与外部世界的连接电路或部件**，外设包括存储器、IO设备、A/D或D/A转换器、控制设备等

大致结构：

![5-7](img/5-7.png)

接口的功能：
- 执行CPU发来的控制命令
- 联络功能
  - 告诉CPU是否准备好、缓冲区是否空或满
- 数据缓冲与锁存
  - 隔离信号，增强总线驱动能力
  - 缓冲与锁存解决CPU与外设速度不匹配的问题
    - 如CPU速度快，只在一瞬间送来地址，那么地址就要被锁存起来使用
- 寻址功能（也称为设备选择功能，即根据CPU发出的外设地址进行译码变为设备选择信号
- 信号转换功能
- 中断管理
  - CPU与中低速外设传递信息使用中断方式
- 数据转换
  - 串并转换、数模转换
- 可编程功能
  - 有些接口芯片可以使用CPU编程来获得不同的效果

IO接口的基本结构：

![5-8](img/5-8.png)

CPU和外设需要交换三种信息：
- 数据信息
- 状态信息
- 控制信息

所以IO接口需要为以上三种信息设置端口，即**数据端口**、**状态端口**和**控制端口**

CPU能做的操作就是**对IO端口进行读写**

## 寻址方式

### 统一编制方式（存储器映射

- 存储器地址与IO端口地址共用一个地址空间，访存与访问IO端口使用相同的指令
- IO空间和存储器空间不必连续，可以交错
- 对IO端口操作灵活
- 缺点：占用存储器地址，对IO操作执行时间长。程序可读性差

![5-9](img/5-9.png)

代码举例：

```
mov a, [1000h]
```

### 独立编制方式（IO映射

8086采用此方式

- 存储器地址和IO端口地址都有各自独立的地址空间，有专门的IO指令
- IO端口不占用存储器地址
- IO指令短，执行速度快，功能单一
- 程序可读性强

![5-10](img/5-10.png)

代码举例：

```
in al, 20h
out dx, al
```

注意in和out的非立即数据必须存放在al中，非立即地址必须在dx中

### IO端口地址译码

两种译码方式：
- 固定式端口地址译码
  - 使用写死的译码器或门电路
- 可选式端口地址译码
  - 使用开关或比较器实现

译码电路实现途径：
- 门电路实现
- 译码器实现

## 基本输入输出接口

注意此处的输入输出都是**相对CPU**的而不是相对接口的

- 基本输入接口（从接口输入到CPU）是一组三态缓冲器(74LS244)
  - 因为CPU速度快，所以当三态缓冲器ready时CPU才能再次读取
- 基本输出接口（从CPU输出到接口）是一组锁存器(74LS374)
  - 因为CPU速度快，所以当锁存器内数据被取走之后CPU才能再次输出

基本输入接口：

![5-11](img/5-11.png)

基本输出接口：

![5-12](img/5-12.png)

## CPU与外设的数据交换方式

### 程序控制方式

包括：
- 无条件传送方式
  - 假设外设速度无限大，不考虑任何情况直接传数据
  - 适用于简单外设
- 查询方式
  - CPU持续主动读取状态字，如果目标ready则读写
  - 效率低，CPU不能与外设并行工作
  - 接口电路简单，硬件开销小
  - 适用于CPU负荷不大、传送速度不高的系统

### 中断方式

- 外设ready时发出中断请求
- CPU和外设可以并行工作
- 接口需要中断控制器的逻辑支持
- 适用于CPU负荷较大、传送速度不太高的系统

### DMA方式

- 数据传送不经过CPU
- 需要DMA控制器、硬件开销大
- 适用于高速大量数据传送的系统

