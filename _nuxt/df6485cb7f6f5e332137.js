(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{1160:function(t,n){const o={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",{staticClass:"frontmatter-markdown"},[o("h2",[t._v("问题描述")]),t._v(" "),o("p",[t._v("目前有模块data，包含一个变量config，并且可以使用函数load为其赋值。代码如下：")]),t._v(" "),o("pre",{staticClass:"language-python"},[o("code",{staticClass:"language-python"},[o("span",{staticClass:"token comment"},[t._v("# data.py")]),t._v("\nconfig "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n"),o("span",{staticClass:"token keyword"},[t._v("def")]),t._v(" "),o("span",{staticClass:"token function"},[t._v("load")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n\t"),o("span",{staticClass:"token keyword"},[t._v("global")]),t._v(" config\n\tconfig "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),o("span",{staticClass:"token string"},[t._v("'key'")]),o("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token string"},[t._v("'value'")]),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n")])]),t._v(" "),o("p",[t._v("模块A使用"),o("code",{pre:!0},[t._v("from x import x")]),t._v("格式导入config:")]),t._v(" "),o("pre",{staticClass:"language-python"},[o("code",{staticClass:"language-python"},[o("span",{staticClass:"token comment"},[t._v("# A.py")]),t._v("\n"),o("span",{staticClass:"token keyword"},[t._v("from")]),t._v(" data "),o("span",{staticClass:"token keyword"},[t._v("import")]),t._v(" config\n"),o("span",{staticClass:"token keyword"},[t._v("def")]),t._v(" "),o("span",{staticClass:"token function"},[t._v("funcA")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n\t"),o("span",{staticClass:"token keyword"},[t._v("print")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("config"),o("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n")])]),t._v(" "),o("p",[t._v("模块B使用"),o("code",{pre:!0},[t._v("import x")]),t._v("格式导入data，然后使用data.config访问config:")]),t._v(" "),o("pre",{staticClass:"language-python"},[o("code",{staticClass:"language-python"},[o("span",{staticClass:"token comment"},[t._v("# B.py")]),t._v("\n"),o("span",{staticClass:"token keyword"},[t._v("import")]),t._v(" data\n"),o("span",{staticClass:"token keyword"},[t._v("def")]),t._v(" "),o("span",{staticClass:"token function"},[t._v("funcB")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n\t"),o("span",{staticClass:"token keyword"},[t._v("print")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("data"),o("span",{staticClass:"token punctuation"},[t._v(".")]),t._v("config"),o("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n")])]),t._v(" "),o("p",[t._v("主模块main分别调用模块A和B的内容，并在某一时刻修改data：")]),t._v(" "),o("pre",{staticClass:"language-python"},[o("code",{staticClass:"language-python"},[o("span",{staticClass:"token comment"},[t._v("# main.py")]),t._v("\n"),o("span",{staticClass:"token keyword"},[t._v("from")]),t._v(" A "),o("span",{staticClass:"token keyword"},[t._v("import")]),t._v(" funcA\n"),o("span",{staticClass:"token keyword"},[t._v("from")]),t._v(" B "),o("span",{staticClass:"token keyword"},[t._v("import")]),t._v(" funcB\n"),o("span",{staticClass:"token keyword"},[t._v("from")]),t._v(" data "),o("span",{staticClass:"token keyword"},[t._v("import")]),t._v(" load\n\nload"),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\nfuncA"),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\nfuncB"),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n")])]),t._v(" "),o("p",[t._v("会发现，输出的结果是")]),t._v(" "),o("pre",{staticClass:"language-python"},[o("code",{staticClass:"language-python"},[o("span",{staticClass:"token punctuation"},[t._v("{")]),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("{")]),o("span",{staticClass:"token string"},[t._v("'key'")]),o("span",{staticClass:"token punctuation"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token string"},[t._v("'value'")]),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n")])]),t._v(" "),o("p",[t._v("即，模块A和模块B都使用了data模块的config变量，输出为何不同？")]),t._v(" "),o("h2",[t._v("分析")]),t._v(" "),o("p",[t._v("上面的例子中，因为模块A使用"),o("code",{pre:!0},[t._v("from data import config")]),t._v("，所以获得的是直接对config的引用。模块B使用"),o("code",{pre:!0},[t._v("import data")]),t._v("，获得的是对data模块的引用。")]),t._v(" "),o("p",[t._v("模块main调用"),o("code",{pre:!0},[t._v("data.load()")]),t._v("函数对config变量进行直接赋值（绑定了另一块内存），抛弃对原对象的引用。然而原对象的内存被模块A的"),o("code",{pre:!0},[t._v("config")]),t._v("绑定所以没有被回收，模块A使用的还是原来的对象。模块B通过"),o("code",{pre:!0},[t._v("data.config")]),t._v("访问到的"),o("code",{pre:!0},[t._v("config")]),t._v("才是新的对象")]),t._v(" "),o("p",[t._v("网上一些关于python跨文件/模块全局变量的问题很多也是由这个原因产生的")]),t._v(" "),o("h2",[t._v("解决方案")]),t._v(" "),o("h3",[t._v("方案一：每次操作变量都重新解析其对象")]),t._v(" "),o("p",[t._v("即，能用"),o("code",{pre:!0},[t._v("import data")]),t._v("就不要"),o("code",{pre:!0},[t._v("from data import config")])]),t._v(" "),o("p",[t._v("这会导致引用过多不需要的东西，以及代码会比较长："),o("code",{pre:!0},[t._v("bulabula.bulabula.bulabula.bulabula")])]),t._v(" "),o("h3",[t._v("方案二：避免对对象本体重新赋值")]),t._v(" "),o("p",[t._v("即，通过修改对象的内部数据达到类似于重新赋值的效果")]),t._v(" "),o("p",[t._v("上述load函数就应该改为：")]),t._v(" "),o("pre",{staticClass:"language-python"},[o("code",{staticClass:"language-python"},[t._v("config "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n"),o("span",{staticClass:"token keyword"},[t._v("def")]),t._v(" "),o("span",{staticClass:"token function"},[t._v("load")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(":")]),t._v("\n\tconfig"),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token string"},[t._v("'key'")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),t._v(" "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token string"},[t._v("'value'")]),t._v("\n")])]),t._v(" "),o("p",[t._v("从模块划分的角度来说显然应该采用方案二")])])}]};t.exports={attributes:{date:"2019-07-30T00:00:00.000Z",title:"python中跨模块变量数据不一致问题",description:"两种import方式导致变量作用域不同",tags:["python"]},vue:{render:o.render,staticRenderFns:o.staticRenderFns,component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=o.render,this.$options.staticRenderFns=o.staticRenderFns}}}}}}]);