(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{1182:function(t,e){const n={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"frontmatter-markdown"},[n("h2",{attrs:{id:"先说结论"}},[t._v("先说结论")]),t._v(" "),n("p",[t._v("在main函数靠前的位置添加如下代码")]),t._v(" "),n("pre",{staticClass:"language-c++"},[n("code",{pre:!0,attrs:{class:"language-c++"}},[t._v('//need #include<windows.h>\nHANDLE hMutex = CreateMutex(NULL, false, (LPCTSTR)"YourAppName");\nif (GetLastError() == ERROR_ALREADY_EXISTS){\n\treturn 0;\n}\n')])]),t._v(" "),n("p",[t._v("效果:")]),t._v(" "),n("p",[t._v("启动应用A得到实例A1，再次启动应用A试图得到实例A2会失败")]),t._v(" "),n("h2",{attrs:{id:"原理"}},[t._v("原理")]),t._v(" "),n("p",[t._v("每次启动应用时，上面的代码调用CreateMutex在系统中产生一个"),n("strong",[t._v("互斥体")])]),t._v(" "),n("p",[t._v('互斥体的名称在上述代码中为"YourAppName"')]),t._v(" "),n("p",[t._v("再次启动应用时又会试图产生同名互斥体，显然这是不允许的")]),t._v(" "),n("p",[t._v("这样就会产生"),n("strong",[t._v("ERROR_ALREADY_EXISTS")]),t._v("错误，通过"),n("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/windows/desktop/ms679360"}},[t._v("GetLastError")]),t._v("()函数获取即可")]),t._v(" "),n("h3",{attrs:{id:"关于互斥体的名称"}},[t._v("关于互斥体的名称")]),t._v(" "),n("p",[t._v("不要和已有其他互斥体重名就好，比如像本例一样使用应用名作为互斥体名")]),t._v(" "),n("h2",{attrs:{id:"风险和其他"}},[t._v("风险和其他")]),t._v(" "),n("p",[t._v("释放互斥体函数"),n("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/windows/desktop/ms685066"}},[n("strong",[t._v("ReleaseMutex")])]),t._v("和关闭线程/句柄函数"),n("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/windows/desktop/ms724211"}},[n("strong",[t._v("CloseHandle")])]),t._v("在此例中没有被调用，因为main函数return时系统会自动做如上工作。如果要实现其他更复杂的判断功能可以考虑调用这两个函数")]),t._v(" "),n("p",[t._v("参考：")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/windows/desktop/ms724211"}},[t._v("CloseHandle function")])]),t._v(" "),n("li",[n("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/windows/desktop/ms682411"}},[t._v("CreateMutex function")])]),t._v(" "),n("li",[n("a",{attrs:{href:"https://blog.csdn.net/ciaos/article/details/7488362"}},[t._v("如何禁止程序启动多个实例")])]),t._v(" "),n("li",[n("a",{attrs:{href:"http://www.cnblogs.com/singlex/archive/2011/12/07/2279913.html"}},[t._v("C# 禁止应用程序多次启动")])])])])}]};t.exports={attributes:{date:"2018-05-26T00:00:00.000Z",title:"Windows防止应用双开",tags:["windows"]},vue:{render:n.render,staticRenderFns:n.staticRenderFns,component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=n.render,this.$options.staticRenderFns=n.staticRenderFns}}}}}}]);