(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{1083:function(t,n){const o={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",{staticClass:"frontmatter-markdown"},[o("h2",{attrs:{id:"产出"}},[t._v("产出")]),t._v(" "),o("p",[t._v("写了个基于QT的简单程序👉"),o("a",{attrs:{href:"https://github.com/DiscreteTom/TaskBarKiller"}},[t._v("TaskBarKiller")]),t._v("👈")]),t._v(" "),o("h2",{attrs:{id:"目标效果"}},[t._v("目标效果")]),t._v(" "),o("p",[t._v("默认"),o("strong",[t._v("任务栏为自动隐藏状态")]),t._v("，即鼠标贴近屏幕边缘可以显示任务栏。")]),t._v(" "),o("p",[t._v("目标是实现在运行非全屏应用时鼠标贴近屏幕边缘不会呼出任务栏，以减少错误操作")]),t._v(" "),o("h2",{attrs:{id:"方案"}},[t._v("方案")]),t._v(" "),o("p",[t._v("搜索得到以下信息")]),t._v(" "),o("ol",[o("li",[t._v("任务栏也是窗口，可以获取句柄")]),t._v(" "),o("li",[t._v("获取句柄的情况下可以使用Windows的"),o("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/windows/desktop/ms633545"}},[t._v("SetWindowsPos")]),t._v("函数实现窗口的置顶与取消置顶等位置操作")]),t._v(" "),o("li",[t._v("获取句柄的情况下可以使用Windows的"),o("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/windows/desktop/ms633548"}},[t._v("ShowWindow")]),t._v("函数实现控制窗口的隐藏与显示")])]),t._v(" "),o("p",[t._v("于是得到以下方案")]),t._v(" "),o("ol",[o("li",[t._v("任务栏始终置底，只有在桌面鼠标贴近屏幕边缘才可以呼出任务栏（信息1+信息2）")]),t._v(" "),o("li",[t._v("设置热键，使用热键切换任务栏的隐藏与显示（信息1+信息3）")])]),t._v(" "),o("p",[t._v("方案1看起来是个优秀的方案，因为只需要设置一次即可满足任何时间的使用需要，而方案2每次调出任务栏需要按下热键。但是根据测试，使用SetWindowPos函数似乎并不对任务栏产生效果。在找到更好的方案之前，"),o("strong",[t._v("暂时选择使用方案2")]),t._v("（测试得到"),o("strong",[t._v("方案2")]),t._v("的另一个"),o("strong",[t._v("缺点")]),t._v("是隐藏任务栏时"),o("strong",[t._v("无法使用Win+数字")]),t._v("快捷键切换或启动应用，使用Alt+Tab切换应用吧）")]),t._v(" "),o("p",[t._v("细化方案2，需要写一个程序，满足：")]),t._v(" "),o("ol",[o("li",[t._v("可以注册全局热键")]),t._v(" "),o("li",[t._v("可以隐藏到系统托盘区域")]),t._v(" "),o("li",[t._v("支持开机自启动")])]),t._v(" "),o("h2",{attrs:{id:"实现"}},[t._v("实现")]),t._v(" "),o("p",[t._v("全局热键使用第三方库QHotkey实现")]),t._v(" "),o("p",[t._v("MainWindow添加头文件")]),t._v(" "),o("pre",{staticClass:"language-cpp"},[o("code",{staticClass:"language-cpp"},[o("span",{staticClass:"token macro property"},[t._v("#"),o("span",{staticClass:"token directive keyword"},[t._v("include")]),t._v(" "),o("span",{staticClass:"token string"},[t._v("<qhotkey.h>")])]),t._v("\n")])]),t._v(" "),o("p",[t._v("添加私有成员")]),t._v(" "),o("pre",{staticClass:"language-cpp"},[o("code",{staticClass:"language-cpp"},[t._v("QHotkey "),o("span",{staticClass:"token operator"},[t._v("*")]),t._v(" hotkey"),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n"),o("span",{staticClass:"token keyword"},[t._v("bool")]),t._v(" taskBarIsHidden"),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n")])]),t._v(" "),o("p",[t._v("构造函数初始化，这里的快捷键选择了和网上相似软件一样的"),o("strong",[t._v("Ctrl+~")])]),t._v(" "),o("pre",{staticClass:"language-cpp"},[o("code",{staticClass:"language-cpp"},[t._v("hotkey "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token keyword"},[t._v("new")]),t._v(" "),o("span",{staticClass:"token function"},[t._v("QHotkey")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token function"},[t._v("QKeySequence")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token string"},[t._v('"Ctrl+`"')]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" "),o("span",{staticClass:"token boolean"},[t._v("true")]),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" "),o("span",{staticClass:"token keyword"},[t._v("this")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),o("span",{staticClass:"token comment"},[t._v("//设置快捷键、默认启动")]),t._v("\n"),o("span",{staticClass:"token function"},[t._v("connect")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("hotkey"),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" "),o("span",{staticClass:"token operator"},[t._v("&")]),t._v("QHotkey"),o("span",{staticClass:"token operator"},[t._v("::")]),t._v("activated"),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" "),o("span",{staticClass:"token keyword"},[t._v("this")]),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" "),o("span",{staticClass:"token operator"},[t._v("&")]),t._v("MainWindow"),o("span",{staticClass:"token operator"},[t._v("::")]),t._v("getHotKeyPressed"),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),o("span",{staticClass:"token comment"},[t._v("//连接快捷键能够触发的功能")]),t._v("\ntaskBarIsHidden "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token boolean"},[t._v("false")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),o("span",{staticClass:"token comment"},[t._v("//默认任务栏是显示的")]),t._v("\n")])]),t._v(" "),o("p",[t._v("添加接收信号的槽函数")]),t._v(" "),o("pre",{staticClass:"language-cpp"},[o("code",{staticClass:"language-cpp"},[o("span",{staticClass:"token keyword"},[t._v("void")]),t._v(" MainWindow"),o("span",{staticClass:"token operator"},[t._v("::")]),o("span",{staticClass:"token function"},[t._v("getHotKeyPressed")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n\tHWND hwnd"),o("span",{staticClass:"token operator"},[t._v("=")]),o("span",{staticClass:"token operator"},[t._v("::")]),o("span",{staticClass:"token function"},[t._v("FindWindow")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("L"),o("span",{staticClass:"token string"},[t._v('"Shell_TrayWnd"')]),o("span",{staticClass:"token punctuation"},[t._v(",")]),o("span",{staticClass:"token constant"},[t._v("NULL")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),o("span",{staticClass:"token comment"},[t._v("//查找任务栏句柄")]),t._v("\n\ttaskBarIsHidden "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token operator"},[t._v("!")]),t._v("taskBarIsHidden"),o("span",{staticClass:"token punctuation"},[t._v(";")]),o("span",{staticClass:"token comment"},[t._v("//切换状态")]),t._v("\n\t"),o("span",{staticClass:"token keyword"},[t._v("if")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("taskBarIsHidden"),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n\t\t"),o("span",{staticClass:"token function"},[t._v("ShowWindow")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("hwnd"),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" "),o("span",{staticClass:"token number"},[t._v("0")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),o("span",{staticClass:"token comment"},[t._v("//hide")]),t._v("\n\t"),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v(" "),o("span",{staticClass:"token keyword"},[t._v("else")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n\t\t"),o("span",{staticClass:"token function"},[t._v("ShowWindow")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("hwnd"),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" "),o("span",{staticClass:"token number"},[t._v("1")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),o("span",{staticClass:"token comment"},[t._v("//show")]),t._v("\n\t"),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n")])]),t._v(" "),o("p",[t._v("为了防止意外情况程序关闭导致任务栏一去不复返，在MainWindow的析构函数中添加显示任务栏的代码，在一定程度上补救一下")]),t._v(" "),o("pre",{staticClass:"language-cpp"},[o("code",{staticClass:"language-cpp"},[t._v("MainWindow"),o("span",{staticClass:"token operator"},[t._v("::")]),o("span",{staticClass:"token operator"},[t._v("~")]),o("span",{staticClass:"token function"},[t._v("MainWindow")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n\tHWND hwnd"),o("span",{staticClass:"token operator"},[t._v("=")]),o("span",{staticClass:"token operator"},[t._v("::")]),o("span",{staticClass:"token function"},[t._v("FindWindow")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("L"),o("span",{staticClass:"token string"},[t._v('"Shell_TrayWnd"')]),o("span",{staticClass:"token punctuation"},[t._v(",")]),o("span",{staticClass:"token constant"},[t._v("NULL")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n\t"),o("span",{staticClass:"token function"},[t._v("ShowWindow")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("hwnd"),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" "),o("span",{staticClass:"token number"},[t._v("1")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),o("span",{staticClass:"token comment"},[t._v("//show")]),t._v("\n\t"),o("span",{staticClass:"token keyword"},[t._v("delete")]),t._v(" ui"),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n")])]),t._v(" "),o("p",[t._v("至此实现主要功能")]),t._v(" "),o("p",[t._v("接下来添加开机自启动功能和最小化托盘功能，之前的博客已经讲过")]),t._v(" "),o("p",[t._v("传送门：")]),t._v(" "),o("ul",[o("li",[o("a",{attrs:{href:"/2018/03/04/Qt%E6%B7%BB%E5%8A%A0%E5%9B%BE%E6%A0%87-%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E7%9B%B8%E5%85%B3-%E6%9C%80%E5%B0%8F%E5%8C%96%E5%88%B0%E6%89%98%E7%9B%98/"}},[t._v("Qt-添加图标、资源文件相关、最小化到托盘")])]),t._v(" "),o("li",[o("a",{attrs:{href:"/2018/04/09/Qt-Windows%E5%BA%94%E7%94%A8%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8%E7%9B%B8%E5%85%B3/"}},[t._v("Qt-Windows应用开机自启动相关")])])]),t._v(" "),o("p",[t._v("参考:")]),t._v(" "),o("ul",[o("li",[o("a",{attrs:{href:"https://blog.csdn.net/wangjieest/article/details/6943241"}},[t._v("任务栏句柄")])]),t._v(" "),o("li",[o("a",{attrs:{href:"http://www.cnblogs.com/Ricky81317/archive/2009/01/16/1376745.html"}},[t._v("如何使任意Windows窗口置顶")])]),t._v(" "),o("li",[o("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/windows/desktop/ms633545"}},[t._v("MSDN-SetWindowPos Function")])]),t._v(" "),o("li",[o("a",{attrs:{href:"http://m.www.cnblogs.com/sjcatsoft/archive/2009/03/13/1410639.html"}},[t._v("C#使用Windows API 隐藏/显示 任务栏 (FindWindowEx, ShowWindow)")])]),t._v(" "),o("li",[o("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/windows/desktop/ms633548"}},[t._v("ShowWindow function")])])])])}]};t.exports={attributes:{date:"2018-05-25T00:00:00.000Z",title:"屏蔽Windows任务栏",description:"基于QT的热键、隐藏任务栏",tags:["windows"]},vue:{render:o.render,staticRenderFns:o.staticRenderFns,component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=o.render,this.$options.staticRenderFns=o.staticRenderFns}}}}}}]);